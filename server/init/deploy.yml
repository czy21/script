- name: os
  hosts: all
  vars_files:
    - "vars/env.yml"
    - "vars/main.yml"
  vars:
    param_role_name: os
  pre_tasks:
    - include_tasks: roles/common/tasks/copy.yml
  roles:
    - '{{ param_role_name }}'
  post_tasks:
    - include_tasks: roles/common/tasks/clean.yml
  tags:
    - '{{ param_role_name }}'

- name: docker
  hosts: all
  vars_files:
    - "vars/env.yml"
    - "vars/main.yml"
  vars:
    param_role_name: docker
  pre_tasks:
    - include_tasks: roles/common/tasks/copy.yml
  roles:
    - '{{ param_role_name }}'
  post_tasks:
    - include_tasks: roles/common/tasks/clean.yml
  tags:
    - '{{ param_role_name }}'

- name: k8s
  hosts: all
  vars_files:
    - "vars/env.yml"
    - "vars/main.yml"
  vars:
    param_role_name: k8s
    param_k8s_backup_name: '{{ param_backup_prefix }}-k8s'
    param_k8s_etcd_cluster_name: 'etcd'
  pre_tasks:
    - import_tasks: roles/common/tasks/mk.yml
      tags:
        - 'k8s-backup'
        - 'k8s-restore'
    - import_tasks: roles/common/tasks/copy.yml
      tags:
        - '{{ param_role_name }}'
        - 'k8s-init-etcd'
        - 'k8s-init-kube'
        - 'k8s-join'
  roles:
    - '{{ param_role_name }}'
  post_tasks:
    - import_tasks: roles/common/tasks/clean.yml
      tags:
        - '{{ param_role_name }}'
#        - 'k8s-init-etcd'
#        - 'k8s-init-kube'
        - 'k8s-join'