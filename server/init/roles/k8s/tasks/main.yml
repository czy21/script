- name: create role dir
  file: path={{ param_remote_role_path }} state=directory

- name: copy files
  template: src={{ item }} dest={{ param_remote_role_path }}
  with_fileglob:
    - templates/*

- name: init iptables
  become: yes
  shell: |-
    cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf
    br_netfilter
    EOF

    cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
    net.bridge.bridge-nf-call-ip6tables = 1
    net.bridge.bridge-nf-call-iptables = 1
    EOF
    sudo sysctl --system

- name: install
  shell: bash {{param_remote_role_path}}/{{ ansible_distribution | lower}}.sh

- include_tasks: "{{param_k8s_role}}.yml"