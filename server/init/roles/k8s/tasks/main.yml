- name: create iptables
  become: yes
  shell: |-
    cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf
    br_netfilter
    EOF

    cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
    net.bridge.bridge-nf-call-ip6tables = 1
    net.bridge.bridge-nf-call-iptables = 1
    EOF
    sudo sysctl --system

- name: install
  shell: bash {{ param_remote_role_path }}/{{ ansible_distribution | lower}}.sh && kubectl completion bash > /etc/bash_completion.d/kubectl

- include_tasks: "{{ param_k8s_role }}.yml"

- name: install helm
  become: yes
  shell: |
    sudo wget -O - https://get.helm.sh/helm-v3.8.0-linux-amd64.tar.gz | sudo tar -zxf - --strip-components 1 -C /usr/local/bin/ linux-amd64/helm
    sudo chmod +x /usr/local/bin/helm
    sudo ln -s /usr/local/bin/helm /usr/bin/helm
    helm completion bash > /etc/bash_completion.d/helm