- name: kubeadm master join
  shell: |
    sudo kubeadm join k8s-vip:16433 --token zv5rtn.9d16qa7gttn0b12e --discovery-token-ca-cert-hash sha256:0ee1acf4d2a3bbdb09c3cc9a759d48f28004cf73737a454d6d9352c84fd8da83 --control-plane --certificate-key 52d74b16e3592cecf176b9e9ce365046a29e282e338357985f4708bdc37c9667
    sudo -i eval 'if [ -z ${KUBECONFIG} ];then echo 'export KUBECONFIG=/etc/kubernetes/admin.conf' >> ~/.bashrc; fi;'
    sudo -u {{ param_user_ops }} bash -c "set -e;cd;mkdir -p .kube && sudo cp --force /etc/kubernetes/admin.conf .kube/config && sudo chown {{ param_user_ops }}:{{ param_user_ops }} .kube/config"
  when: 'inventory_hostname in groups["master"][1:]'

- name: kubeadm worker join
  shell: |
    sudo kubeadm join k8s-vip:16433 --token zv5rtn.9d16qa7gttn0b12e --discovery-token-ca-cert-hash sha256:0ee1acf4d2a3bbdb09c3cc9a759d48f28004cf73737a454d6d9352c84fd8da83
  when: 'inventory_hostname in groups["worker"]'