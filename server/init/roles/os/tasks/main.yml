- name: valid
  assert:
    that: param_user_ops_ssh_public_key | trim != ""
    fail_msg: param_user_ops_ssh_public_key is empty

- name: mirror
  shell: sh {{ param_remote_role_path }}/mirror.sh
  when: param_mirror_use_proxy

- name: install
  shell: |-
    timedatectl set-timezone Asia/Shanghai
    if [ "rocky" = "{{ param_ansible_distribution }}" ];then
      sh {{ param_remote_role_path }}/centos.sh
    else
      sh {{ param_remote_role_path }}/{{ param_ansible_distribution }}.sh
    fi

- name: sshd_config
  shell: |-
    cat << EOF > /etc/ssh/sshd_config.d/99-custom.conf
    UseDNS no
    PermitRootLogin yes
    PasswordAuthentication no
    ClientAliveInterval 30
    EOF