- name: prune
  hosts: all
  remote_user: bruce
  become: yes
  tasks:
    - name: calico prune
      shell: nmcli d status | grep "^cali\|^tun" | awk '{print $1}' | xargs nmcli device delete -
    - name: docker login prune
      shell: rm -rf $HOME/.docker --force
    - name: docker container prune
      shell: docker container prune --force
    - name: docker volume prune
      shell: docker volume prune --force
    - name: docker image prune
      shell: docker image prune --all --force
    - name: docker network prune
      shell: docker network prune --force
    - name: k8s reset
      shell: kubeadm reset --force
    - name: machine reboot
      shell: reboot
    - name: machine shutdown
      shell: shutdown -h now
  tags:
    - prune

- name: k8s-reset
  hosts: all
  remote_user: bruce
  become: yes
  tasks:
    - name: k8s reset
      shell: kubeadm reset --force
  tags:
    - k8s-reset