<source>
  @type  forward
  port  24224
  bind 0.0.0.0
</source>

<source>
  @type prometheus
</source>

<filter docker.nginx>
  @type parser
  key_name log
  reserve_data true
  <parse>
  @type regexp
  expression /^(?<remote>[^ ]*) - (?<user>[^ ]*) \[(?<time>[^\]]*)\] (?<host>[^ ]*) "(?<method>\S+)(?: +(?<path>[^\"]*?)(?: +\S*)?)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)"(?:\s+(?<http_x_forwarded_for>[^ ]+))?)? (?<request_time>[^ ]*) (?<upstream_response_time>[^ ]*)$/
    time_format %d/%b/%Y:%H:%M:%S %z
    types size:integer,rt:float,urt:float
  </parse>
</filter>

<filter docker.nginx>
  @type prometheus

  <metric>
    name nginx_size_bytes_total
    type counter
    desc nginx bytes sent
    key size
  </metric>

  <metric>
    name nginx_http_request_code_total
    type counter
    desc nginx http request code
    <labels>
      host ${host}
      method ${method}
      path ${path}
      code ${code}
      size ${size}
    </labels>
  </metric>
</filter>