<source>
  @type  forward
  port  24224
  bind 0.0.0.0
</source>

<source>
  @type prometheus
</source>

<filter docker.nginx>
  @type parser
  key_name log
  reserve_data true
  <parse>
  @type regexp
  expression /^(?<remote>[^ ]*) - (?<user>[^ ]*) \[(?<time>[^\]]*)\] (?<host>[^ ]*) "(?<method>\S+)(?: +(?<path>[^\"]*?)(?: +\S*)?)?" (?<status>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)"(?:\s+(?<http_x_forwarded_for>[^ ]+))?)? (?<request_time>[^ ]*) (?<upstream_response_time>[^ ]*)$/
    time_format %d/%b/%Y:%H:%M:%S %z
    types size:integer,request_time:float,upstream_response_time:float
  </parse>
</filter>

<filter docker.nginx>
  @type prometheus

  <metric>
    name nginx_size_bytes_total
    type counter
    desc nginx bytes sent
    key size
    <labels>
      host   ${host}
    </labels>
  </metric>

  <metric>
    name nginx_request_status_total
    type counter
    desc nginx request status
    <labels>
      host   ${host}
      method ${method}
      path   ${path}
      status ${status}
    </labels>
  </metric>

  <metric>
    name nginx_request_duration_total_seconds
    type counter
    desc nginx request time
    key request_time
    <labels>
     host   ${host}
     method ${method}
     status ${status}
    </labels>
  </metric>
  <metric>
    name nginx_upstream_response_duration_total_seconds
    type counter
    desc nginx upstream response time
    key upstream_response_time
    <labels>
     host   ${host}
     method ${method}
     status ${status}
    </labels>
  </metric>
  <metric>
    name nginx_request_duration_seconds
    type summary
    desc nginx request duration summary
    key request_time
    <labels>
     host   ${host}
     method ${method}
     status ${status}
    </labels>
  </metric>
  <metric>
    name nginx_upstream_duration_seconds
    type summary
    desc nginx upstream duration summary
    key upstream_response_time
    <labels>
     host   ${host}
     method ${method}
     status ${status}
    </labels>
  </metric>
</filter>