version: "3.9"

services:

  jenkins-ssh-agent:
    image: "{{ param_registry_url }}/{{ param_registry_dir }}/jenkins-ssh-agent:{{ param_role_image_version }}"
    pull_policy: always
    container_name: jenkins-ssh-agent
    privileged: true
    ports:
      - "5022:22"
    volumes:
      - {{ param_docker_data }}/{{ param_role_name }}/data/:/home/jenkins/
      - {{ param_docker_data }}/{{ param_role_name }}/data/.jenkins:/home/jenkins/.jenkins
      - {{ param_docker_data }}/{{ param_role_name }}/data/agent:/home/jenkins/agent
      - {{ param_docker_data }}/docker/conf/certs/:/docker-certs/client:ro
      - /run/:/run/
      - /var/run/:/var/run/
      - /tmp/:/tmp/
    environment:
      JENKINS_AGENT_SSH_PUBKEY: "{{ param_user_ops_ssh_public_key }}"
      DOCKER_HOST: tcp://docker:2376
      DOCKER_CERT_PATH: /docker-certs/client
      DOCKER_TLS_VERIFY: 1
    restart: always