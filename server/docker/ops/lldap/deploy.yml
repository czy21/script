version: "3"

services:

  lldap:
    image: lldap/lldap:stable
    container_name: lldap
    privileged: true
    user: root
    ports:
      # For LDAP, not recommended to expose, see Usage section.
      - "3890:3890"
      # For LDAPS (LDAP Over SSL), enable port if LLDAP_LDAPS_OPTIONS__ENABLED set true, look env below
      - "6360:6360"
      # For the web front-end
      - "17170:17170"
    volumes:
      - "{{ param_docker_data }}/{{ param_role_name }}/data/:/data/"
    environment:
      TZ: Asia/ShangHai
      LLDAP_JWT_SECRET: {{ param_jwt_secret }}
      LLDAP_KEY_SEED: {{ param_jwt_secret }}
      LLDAP_FORCE_UPDATE_PRIVATE_KEY: "false"
      LLDAP_FORCE_LDAP_USER_PASS_RESET: "false"
      LLDAP_LDAP_BASE_DN: dc=czy21,dc=com
      LLDAP_LDAP_USER_PASS: {{ param_manage_password }}
      LLDAP_DATABASE_URL: mysql://{{ param_db_mysql_username }}:{{ param_db_mysql_password }}@{{ param_db_mysql_host }}:{{ param_db_mysql_port }}/lldap
    restart: always