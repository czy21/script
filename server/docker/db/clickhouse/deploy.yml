version: "3.9"


services:
  {%- for i in range(1,param_bd_clickhouse_replicas | int + 1) %}
  {{ param_role_name }}-{{ i }}:
    image: clickhouse/clickhouse-server:22.8
    container_name: {{ param_role_name }}-{{ i }}
    expose:
      - "8123"
      - "9000"
      - "9009"
      - "9004"
    ports:
      - '8123:8123'
      - '9000:9000'
      - '9009:9009'
      - '9004:9004'
    volumes:
      - '{{ param_docker_data }}/{{ param_role_name }}/conf/config.xml:/etc/clickhouse-server/config.d/config.xml'
      - '{{ param_docker_data }}/{{ param_role_name }}/conf/users.xml:/etc/clickhouse-server/users.d/users.xml'
      - '{{ param_docker_data }}/{{ param_role_name }}/data/{{ i }}:/var/lib/clickhouse/'
      - '{{ param_docker_data }}/{{ param_role_name }}/data/{{ i }}/data/:/var/lib/clickhouse/data/'
      - '{{ param_docker_data }}/{{ param_role_name }}/log/{{ i }}:/var/log/'
  {%- endfor %}