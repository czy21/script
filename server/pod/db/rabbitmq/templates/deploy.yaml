apiVersion: rabbitmq.com/v1beta1
kind: RabbitmqCluster
metadata:
  name: {{ .Chart.Name }}
  namespace: {{ .Release.Namespace }}
spec:
  replicas: 2
  rabbitmq:
    additionalConfig: |
      load_definitions = /var/lib/rabbitmq/definitions.json
  override:
    service:
      spec:
        type: NodePort
        ports:
          - name: "5672"
            port: 5672
            targetPort: 5672
            nodePort: 5672
          - name: "15672"
            port: 15672
            targetPort: 15672
            nodePort: 15672
          - name: "15692"
            port: 15692
            targetPort: 15692
            nodePort: 15692
    statefulSet:
      spec:
        template:
          spec:
            containers:
            - name: rabbitmq
              volumeMounts:
              - name: definitions
                mountPath: /var/lib/rabbitmq/definitions.json
                subPath: definitions.json
            volumes:
            - name: definitions
              configMap:
                name: {{ .Chart.Name }}
                items:
                - key: definitions.json
                  path: definitions.json