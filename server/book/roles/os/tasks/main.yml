- name: valid
  assert:
    that: param_user_ops_ssh_public_key | trim != ""
    fail_msg: param_user_ops_ssh_public_key is empty
  tags:
    - "os"

- name: mirror
  shell: sh {{ param_remote_role_path }}/mirror.sh
  when: param_mirror_use_proxy
  tags:
    - "os"
    - "os-mirror"

- name: install
  shell: |-
    timedatectl set-timezone Asia/Shanghai
    sh {{ param_remote_role_path }}/{{ param_ansible_os_family }}.sh
  tags:
    - "os"

- name: sshd_config
  shell: |-
    tee /etc/ssh/sshd_config.d/99-custom.conf << EOF
    UseDNS no
    PermitRootLogin yes
    PasswordAuthentication no
    ClientAliveInterval 30
    EOF
  tags:
    - "os"
    - "os-sshd"

- name: go
  shell: |-
    sh {{ param_remote_role_path }}/sdk-go.sh
  tags:
    - "sdk-go"

- name: java
  shell: |-
    sh {{ param_remote_role_path }}/sdk-java.sh
  tags:
    - "sdk-java"

- name: dotnet
  shell: |-
    sh {{ param_remote_role_path }}/{{ param_ansible_os_family }}-dotnet.sh
  tags:
    - "sdk-dotnet"

- name: nginx
  shell: |-
    sh {{ param_remote_role_path }}/{{ param_ansible_os_family }}-nginx.sh
  tags:
    - "svc-nginx"

- name: redis
  shell: |-
    sh {{ param_remote_role_path }}/{{ param_ansible_os_family }}-redis.sh
  tags:
    - "svc-redis"

- name: mysql
  shell: |-
    sh {{ param_remote_role_path }}/{{ param_ansible_os_family }}-mysql.sh
  tags:
    - "svc-mysql"

- name: mongo
  shell: |-
    sh {{ param_remote_role_path }}/{{ param_ansible_os_family }}-mongo.sh
  tags:
    - "svc-mongo"